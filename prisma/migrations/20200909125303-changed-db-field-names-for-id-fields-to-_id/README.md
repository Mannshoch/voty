# Migration `20200909125303-changed-db-field-names-for-id-fields-to-_id`

This migration has been generated by Stefan N at 9/9/2020, 2:53:03 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."ballots_threadId_unique"

ALTER TABLE "public"."Options" DROP CONSTRAINT "Options_ballotId_fkey"

ALTER TABLE "public"."attachments" DROP CONSTRAINT "attachments_ballotId_fkey"

ALTER TABLE "public"."attachments" DROP CONSTRAINT "attachments_threadId_fkey"

ALTER TABLE "public"."attachments" DROP CONSTRAINT "attachments_userId_fkey"

ALTER TABLE "public"."ballots" DROP CONSTRAINT "ballots_creatorId_fkey"

ALTER TABLE "public"."ballots" DROP CONSTRAINT "ballots_schoolId_fkey"

ALTER TABLE "public"."ballots" DROP CONSTRAINT "ballots_teamId_fkey"

ALTER TABLE "public"."ballots" DROP CONSTRAINT "ballots_threadId_fkey"

ALTER TABLE "public"."reactions" DROP CONSTRAINT "reactions_threadId_fkey"

ALTER TABLE "public"."reactions" DROP CONSTRAINT "reactions_userId_fkey"

ALTER TABLE "public"."schools" DROP CONSTRAINT "schools_domainId_fkey"

ALTER TABLE "public"."threads" DROP CONSTRAINT "threads_parentId_fkey"

ALTER TABLE "public"."threads" DROP CONSTRAINT "threads_userId_fkey"

ALTER TABLE "public"."voted" DROP CONSTRAINT "voted_ballotId_fkey"

ALTER TABLE "public"."voted" DROP CONSTRAINT "voted_userId_fkey"

ALTER TABLE "public"."votes" DROP CONSTRAINT "votes_ballotId_fkey"

ALTER TABLE "public"."attachments" DROP COLUMN "userId",
DROP COLUMN "ballotId",
DROP COLUMN "threadId",
ADD COLUMN "user_id" integer   NOT NULL ,
ADD COLUMN "ballot_id" integer   ,
ADD COLUMN "thread_id" integer   

ALTER TABLE "public"."ballots" DROP COLUMN "schoolId",
DROP COLUMN "teamId",
DROP COLUMN "creatorId",
DROP COLUMN "threadId",
ADD COLUMN "school_id" integer   ,
ADD COLUMN "team_id" integer   ,
ADD COLUMN "creator_id" integer   ,
ADD COLUMN "thread_id" integer   

ALTER TABLE "public"."reactions" DROP COLUMN "userId",
DROP COLUMN "threadId",
ADD COLUMN "user_id" integer   NOT NULL ,
ADD COLUMN "thread_id" integer   

ALTER TABLE "public"."schools" DROP COLUMN "domainId",
ADD COLUMN "domain_id" integer   

ALTER TABLE "public"."threads" DROP COLUMN "userId",
DROP COLUMN "parentId",
ADD COLUMN "user_id" integer   NOT NULL ,
ADD COLUMN "parent_id" integer   

ALTER TABLE "public"."voted" DROP COLUMN "userId",
DROP COLUMN "ballotId",
ADD COLUMN "user_id" integer   NOT NULL ,
ADD COLUMN "ballot_id" integer   NOT NULL 

ALTER TABLE "public"."votes" DROP COLUMN "ballotId",
ADD COLUMN "ballot_id" integer   NOT NULL 

CREATE TABLE "public"."options" (
"id" SERIAL,
"vote" integer   NOT NULL ,
"title" text   NOT NULL ,
"ballot_id" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "ballots_thread_id_unique" ON "public"."ballots"("thread_id")

ALTER TABLE "public"."options" ADD FOREIGN KEY ("ballot_id")REFERENCES "public"."ballots"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."attachments" ADD FOREIGN KEY ("user_id")REFERENCES "public"."users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."attachments" ADD FOREIGN KEY ("ballot_id")REFERENCES "public"."ballots"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."attachments" ADD FOREIGN KEY ("thread_id")REFERENCES "public"."threads"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ballots" ADD FOREIGN KEY ("school_id")REFERENCES "public"."schools"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ballots" ADD FOREIGN KEY ("team_id")REFERENCES "public"."teams"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ballots" ADD FOREIGN KEY ("creator_id")REFERENCES "public"."users"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ballots" ADD FOREIGN KEY ("thread_id")REFERENCES "public"."threads"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."reactions" ADD FOREIGN KEY ("user_id")REFERENCES "public"."users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."reactions" ADD FOREIGN KEY ("thread_id")REFERENCES "public"."threads"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."schools" ADD FOREIGN KEY ("domain_id")REFERENCES "public"."domains"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."threads" ADD FOREIGN KEY ("user_id")REFERENCES "public"."users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."threads" ADD FOREIGN KEY ("parent_id")REFERENCES "public"."threads"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."voted" ADD FOREIGN KEY ("user_id")REFERENCES "public"."users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."voted" ADD FOREIGN KEY ("ballot_id")REFERENCES "public"."ballots"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."votes" ADD FOREIGN KEY ("ballot_id")REFERENCES "public"."ballots"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."Options"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200909124648-added-votes-and-options-to-ballots..20200909125303-changed-db-field-names-for-id-fields-to-_id
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -118,9 +118,9 @@
   city     String   @default("")
   canton   String   @default("")
   zip      String   @default("")
   address  String   @default("")
-  domainId Int?
+  domainId Int?     @map(name: "domain_id")
   members  User[]   @relation("SchoolUser")
   teams    Team[]   @relation("SchoolTeam")
   ballots  Ballot[]
@@ -155,48 +155,49 @@
   attachments Attachment[]
   scope       Scope        @default(PUBLIC)
   canton      String?
   school      School?      @relation(fields: [schoolId], references: [id])
-  schoolId    Int?
+  schoolId    Int?         @map(name: "school_id")
   team        Team?        @relation(fields: [teamId], references: [id])
-  teamId      Int?
-  creator     User         @relation(fields: [creatorId], references: [id])
-  creatorId   Int
+  teamId      Int?         @map(name: "team_id")
+  creator     User?        @relation(fields: [creatorId], references: [id])
+  creatorId   Int?         @map(name: "creator_id")
   thread      Thread?      @relation(fields: [threadId], references: [id])
-  threadId    Int?
+  threadId    Int?         @map(name: "thread_id")
   options Options[]
   voted   Voted[]
   votes   Votes[]
   createdAt DateTime @default(now()) @map(name: "created_at")
   updatedAt DateTime @default(now()) @map(name: "updated_at")
-
   @@map(name: "ballots")
 }
 model Options {
   id       Int    @default(autoincrement()) @id
   vote     Int
   title    String
   ballot   Ballot @relation(fields: [ballotId], references: [id])
-  ballotId Int
+  ballotId Int    @map(name: "ballot_id")
+
+  @@map(name: "options")
 }
 model Voted {
   id       Int    @default(autoincrement()) @id
   user     User   @relation(fields: [userId], references: [id])
-  userId   Int
+  userId   Int    @map(name: "user_id")
   ballot   Ballot @relation(fields: [ballotId], references: [id])
-  ballotId Int
+  ballotId Int    @map(name: "ballot_id")
   @@map(name: "voted")
 }
 model Votes {
   id       Int     @default(autoincrement()) @id
   ballot   Ballot  @relation(fields: [ballotId], references: [id])
-  ballotId Int
+  ballotId Int     @map(name: "ballot_id")
   vote     Int // 0 = abstention, 1-x = chosen option
   verify   String? // encrypted verification token
   @@map(name: "votes")
@@ -206,13 +207,13 @@
   id       Int     @default(autoincrement()) @id
   file     String
   title    String  @default("")
   user     User    @relation(fields: [userId], references: [id])
-  userId   Int
+  userId   Int     @map(name: "user_id")
   ballot   Ballot? @relation(fields: [ballotId], references: [id])
-  ballotId Int?
+  ballotId Int?    @map(name: "ballot_id")
   thread   Thread? @relation(fields: [threadId], references: [id])
-  threadId Int?
+  threadId Int?    @map(name: "thread_id")
   createdAt DateTime @default(now()) @map(name: "created_at")
   updatedAt DateTime @default(now()) @map(name: "updated_at")
@@ -223,11 +224,11 @@
   id       Int     @default(autoincrement()) @id
   title    String  @default("")
   text     String  @default("")
   user     User    @relation(fields: [userId], references: [id])
-  userId   Int
+  userId   Int     @map(name: "user_id")
   parent   Thread? @relation(fields: [parentId], references: [id])
-  parentId Int?
+  parentId Int?    @map(name: "parent_id")
   ref         String? // this can be used to reference a thread to content
   ballot      Ballot?
   children    Thread[]     @relation("ThreadToThread")
@@ -242,11 +243,11 @@
 model Reaction {
   id        Int      @default(autoincrement()) @id
   emoij     String
   user      User     @relation(fields: [userId], references: [id])
-  userId    Int
+  userId    Int      @map(name: "user_id")
   thread    Thread?  @relation(fields: [threadId], references: [id])
-  threadId  Int?
+  threadId  Int?     @map(name: "thread_id")
   createdAt DateTime @default(now()) @map(name: "created_at")
   updatedAt DateTime @default(now()) @map(name: "updated_at")
   @@map(name: "reactions")
```


