# Migration `20201012140134-added-team-and-school-to-votes`

This migration has been generated by Stefan N at 10/12/2020, 4:01:34 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."votes" ADD COLUMN "team_id" text   ,
ADD COLUMN "school_id" text   

ALTER TABLE "public"."votes" ADD FOREIGN KEY ("team_id")REFERENCES "public"."teams"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."votes" ADD FOREIGN KEY ("school_id")REFERENCES "public"."schools"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201012131749-schema--re---initialization..20201012140134-added-team-and-school-to-votes
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -37,12 +37,12 @@
   canton   String? // if not set via school
   role     Role    @default(Student)
   school   School? @relation(fields: [schoolId], references: [id])
+  schoolId String? @map(name: "school_id")
   team     Team?   @relation(fields: [teamId], references: [id])
   teamId   String? @map(name: "team_id")
   teaches  Team[]  @relation("Teacher")
-  schoolId String? @map(name: "school_id")
   ballots     Ballot[]
   attachments Attachment[]
   threads     Thread[]
@@ -82,8 +82,10 @@
   domainId  String?  @map(name: "domain_id")
   User User[]
   @@map(name: "teams")
+  BallotRun BallotRun[]
+  Vote      Vote[]
 }
 model School {
   id      String @id @default(cuid())
@@ -93,15 +95,16 @@
   zip     String @default("")
   address String @default("")
   type    String @default("")
-  domain   Domain? @relation(fields: [domainId], references: [id])
-  domainId String? @map(name: "domain_id")
+  domain   Domain?  @relation(fields: [domainId], references: [id])
+  domainId String?  @map(name: "domain_id")
   members  User[]
   teams    Team[]
   ballots  Ballot[]
   @@map(name: "schools")
+  Vote Vote[]
 }
 model Domain {
   id       String  @id @default(cuid())
@@ -156,25 +159,26 @@
   createdAt DateTime @default(now()) @map(name: "created_at")
   updatedAt DateTime @default(now()) @map(name: "updated_at")
   @@map(name: "ballots")
+  BallotRun BallotRun[]
 }
 model BallotRun {
-  id        String   @id @default(cuid())
-  start     DateTime?
-  end       DateTime?
+  id    String    @id @default(cuid())
+  start DateTime?
+  end   DateTime?
-  ballot    Ballot   @relation(fields: [ballotId], references: [id])
-  ballotId  String   @map(name: "ballot_id")
-  team      Team     @relation(fields: [teamId], references: [id])
-  teamId    String   @map(name: "team_id")
+  ballot   Ballot @relation(fields: [ballotId], references: [id])
+  ballotId String @map(name: "ballot_id")
+  team     Team   @relation(fields: [teamId], references: [id])
+  teamId   String @map(name: "team_id")
   @@map(name: "ballot_runs")
 }
 model Option {
-  id    String       @id @default(cuid())
+  id    String @id @default(cuid())
   vote  Int
   title String
   ballot   Ballot @relation(fields: [ballotId], references: [id])
@@ -183,45 +187,49 @@
   @@map(name: "options")
 }
 model Voted {
-  id        String  @id @default(cuid())
+  id String @id @default(cuid())
   signature String? // encrypted signature of the user
-  user      User    @relation(name: "VotedUser", fields: [userId], references: [id])
-  userId    String  @map(name: "user_id")
-  ballot    Ballot  @relation(name: "VotedBallot", fields: [ballotId], references: [id])
-  ballotId  String  @map(name: "ballot_id")
+  user     User   @relation(name: "VotedUser", fields: [userId], references: [id])
+  userId   String @map(name: "user_id")
+  ballot   Ballot @relation(name: "VotedBallot", fields: [ballotId], references: [id])
+  ballotId String @map(name: "ballot_id")
   @@map(name: "voted")
 }
 model Vote {
-  id         String   @id @default(cuid())
-  vote       Int      // 0 = abstention, 1-x = chosen option
+  id         String  @id @default(cuid())
+  vote       Int // 0 = abstention, 1-x = chosen option
   verify     String? // encrypted verification token
   year       Int?
   canton     String?
   schooltype String?
-  ballot     Ballot   @relation(fields: [ballotId], references: [id])
-  ballotId   String   @map(name: "ballot_id")
+  ballot   Ballot  @relation(fields: [ballotId], references: [id])
+  ballotId String  @map(name: "ballot_id")
+  team     Team?   @relation(fields: [teamId], references: [id])
+  teamId   String? @map(name: "team_id")
+  school   School? @relation(fields: [schoolId], references: [id])
+  schoolId String? @map(name: "school_id")
   @@map(name: "votes")
 }
 model Attachment {
-  id    String   @id @default(cuid())
+  id    String @id @default(cuid())
   file  String
-  title String   @default("")
+  title String @default("")
-  user     User     @relation(fields: [userId], references: [id])
-  userId   String   @map(name: "user_id")
-  ballot   Ballot?  @relation(fields: [ballotId], references: [id])
-  ballotId String?  @map(name: "ballot_id")
-  thread   Thread?  @relation(fields: [threadId], references: [id])
-  threadId String?  @map(name: "thread_id")
+  user     User    @relation(fields: [userId], references: [id])
+  userId   String  @map(name: "user_id")
+  ballot   Ballot? @relation(fields: [ballotId], references: [id])
+  ballotId String? @map(name: "ballot_id")
+  thread   Thread? @relation(fields: [threadId], references: [id])
+  threadId String? @map(name: "thread_id")
   createdAt DateTime @default(now()) @map(name: "created_at")
   updatedAt DateTime @default(now()) @map(name: "updated_at")
   @@map(name: "attachments")
@@ -248,9 +256,9 @@
   @@map(name: "threads")
 }
 model Reaction {
-  id    String     @id @default(cuid())
+  id    String @id @default(cuid())
   emoij String
   user     User    @relation(fields: [userId], references: [id])
   userId   String  @map(name: "user_id")
```


