# Migration `20200910144622-clean-up-of-fields`

This migration has been generated by Stefan N at 9/10/2020, 4:46:22 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."teams" DROP CONSTRAINT "teams_domainId_fkey"

ALTER TABLE "public"."teams" DROP CONSTRAINT "teams_schoolId_fkey"

ALTER TABLE "public"."teams" DROP CONSTRAINT "teams_teacherId_fkey"

ALTER TABLE "public"."teams" DROP COLUMN "schoolId",
DROP COLUMN "teacherId",
DROP COLUMN "domainId",
ADD COLUMN "school_id" integer   NOT NULL ,
ADD COLUMN "team_id" integer   NOT NULL ,
ADD COLUMN "domain_id" integer   

ALTER TABLE "public"."teams" ADD FOREIGN KEY ("school_id")REFERENCES "public"."schools"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."teams" ADD FOREIGN KEY ("team_id")REFERENCES "public"."users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."teams" ADD FOREIGN KEY ("domain_id")REFERENCES "public"."domains"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200909195417-further-migration-from-team-id-to-team_id..20200910144622-clean-up-of-fields
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -66,10 +66,10 @@
   password String?
   gender   Gender  @default(UNKOWN)
   role     Role    @default(STUDENT)
-  school   School? @relation(name: "SchoolUser", fields: [schoolId], references: [id])
-  team     Team?   @relation(name: "TeamMembers", fields: [teamId], references: [id])
+  school   School? @relation(fields: [schoolId], references: [id])
+  team     Team?   @relation(fields: [teamId], references: [id])
   teaches  Team[]  @relation("Teacher")
   schoolId Int?    @map(name: "school_id")
   teamId   Int?    @map(name: "team_id")
@@ -81,8 +81,9 @@
   createdAt DateTime @default(now()) @map(name: "created_at")
   updatedAt DateTime @default(now()) @map(name: "updated_at")
   @@map(name: "users")
+  Team Team? @relation("TeamMembers", fields: [teamId], references: [id])
 }
 model VerificationRequest {
   id         Int      @default(autoincrement()) @id
@@ -95,46 +96,50 @@
   @@map(name: "verification_requests")
 }
 model Team {
-  id        Int      @default(autoincrement()) @id
-  name      String
-  school    School   @relation(name: "SchoolTeam", fields: [schoolId], references: [id])
-  schoolId  Int
+  id     Int     @default(autoincrement()) @id
+  name   String
+  invite String? @unique
+
+  school    School   @relation(fields: [schoolId], references: [id])
+  schoolId  Int      @map(name: "school_id")
   teacher   User     @relation(name: "Teacher", fields: [teacherId], references: [id])
-  teacherId Int
+  teacherId Int      @map(name: "team_id")
   members   User[]   @relation("TeamMembers")
   ballots   Ballot[]
-  invite    String?  @unique
   domain    Domain?  @relation(fields: [domainId], references: [id])
-  domainId  Int?
+  domainId  Int?     @map(name: "domain_id")
   @@map(name: "teams")
+  User User[]
 }
 model School {
-  id       Int      @default(autoincrement()) @id
-  name     String
+  id      Int    @default(autoincrement()) @id
+  name    String
+  city    String @default("")
+  canton  String @default("")
+  zip     String @default("")
+  address String @default("")
+
   domain   Domain?  @relation(fields: [domainId], references: [id])
-  city     String   @default("")
-  canton   String   @default("")
-  zip      String   @default("")
-  address  String   @default("")
   domainId Int?     @map(name: "domain_id")
-  members  User[]   @relation("SchoolUser")
-  teams    Team[]   @relation("SchoolTeam")
+  members  User[]
+  teams    Team[]
   ballots  Ballot[]
   @@map(name: "schools")
 }
 model Domain {
-  id       Int      @default(autoincrement()) @id
-  name     String   @unique
-  approved Boolean  @default(false)
-  schools  School[]
-  Team     Team[]
+  id       Int     @default(autoincrement()) @id
+  name     String  @unique
+  approved Boolean @default(false)
+  schools School[]
+  Team    Team[]
+
   @@map(name: "domains")
 }
 enum Scope {
@@ -150,42 +155,44 @@
   title       String
   description String
   start       DateTime
   end         DateTime
+  scope       Scope    @default(PUBLIC)
+  canton      String?
+  school    School? @relation(fields: [schoolId], references: [id])
+  schoolId  Int?    @map(name: "school_id")
+  team      Team?   @relation(fields: [teamId], references: [id])
+  teamId    Int?    @map(name: "team_id")
+  creator   User?   @relation(fields: [creatorId], references: [id])
+  creatorId Int?    @map(name: "creator_id")
+  thread    Thread? @relation(fields: [threadId], references: [id])
+  threadId  Int?    @map(name: "thread_id")
+
+  options     Options[]
+  voted       Voted[]
+  votes       Votes[]
   attachments Attachment[]
-  scope       Scope        @default(PUBLIC)
-  canton      String?
-  school      School?      @relation(fields: [schoolId], references: [id])
-  schoolId    Int?         @map(name: "school_id")
-  team        Team?        @relation(fields: [teamId], references: [id])
-  teamId      Int?         @map(name: "team_id")
-  creator     User?        @relation(fields: [creatorId], references: [id])
-  creatorId   Int?         @map(name: "creator_id")
-  thread      Thread?      @relation(fields: [threadId], references: [id])
-  threadId    Int?         @map(name: "thread_id")
-  options Options[]
-  voted   Voted[]
-  votes   Votes[]
-
   createdAt DateTime @default(now()) @map(name: "created_at")
   updatedAt DateTime @default(now()) @map(name: "updated_at")
   @@map(name: "ballots")
 }
 model Options {
-  id       Int    @default(autoincrement()) @id
-  vote     Int
-  title    String
+  id    Int    @default(autoincrement()) @id
+  vote  Int
+  title String
+
   ballot   Ballot @relation(fields: [ballotId], references: [id])
   ballotId Int    @map(name: "ballot_id")
   @@map(name: "options")
 }
 model Voted {
-  id       Int    @default(autoincrement()) @id
+  id Int @default(autoincrement()) @id
+
   user     User   @relation(fields: [userId], references: [id])
   userId   Int    @map(name: "user_id")
   ballot   Ballot @relation(fields: [ballotId], references: [id])
   ballotId Int    @map(name: "ballot_id")
@@ -193,21 +200,23 @@
   @@map(name: "voted")
 }
 model Votes {
-  id       Int     @default(autoincrement()) @id
-  ballot   Ballot  @relation(fields: [ballotId], references: [id])
-  ballotId Int     @map(name: "ballot_id")
-  vote     Int // 0 = abstention, 1-x = chosen option
-  verify   String? // encrypted verification token
+  id     Int     @default(autoincrement()) @id
+  vote   Int // 0 = abstention, 1-x = chosen option
+  verify String? // encrypted verification token
+  ballot   Ballot @relation(fields: [ballotId], references: [id])
+  ballotId Int    @map(name: "ballot_id")
+
   @@map(name: "votes")
 }
 model Attachment {
-  id       Int     @default(autoincrement()) @id
-  file     String
-  title    String  @default("")
+  id    Int    @default(autoincrement()) @id
+  file  String
+  title String @default("")
+
   user     User    @relation(fields: [userId], references: [id])
   userId   Int     @map(name: "user_id")
   ballot   Ballot? @relation(fields: [ballotId], references: [id])
   ballotId Int?    @map(name: "ballot_id")
@@ -215,22 +224,22 @@
   threadId Int?    @map(name: "thread_id")
   createdAt DateTime @default(now()) @map(name: "created_at")
   updatedAt DateTime @default(now()) @map(name: "updated_at")
-
   @@map(name: "attachments")
 }
 model Thread {
-  id       Int     @default(autoincrement()) @id
-  title    String  @default("")
-  text     String  @default("")
+  id    Int     @default(autoincrement()) @id
+  title String  @default("")
+  text  String  @default("")
+  ref   String? // this can be used to reference a thread to content
+
   user     User    @relation(fields: [userId], references: [id])
   userId   Int     @map(name: "user_id")
   parent   Thread? @relation(fields: [parentId], references: [id])
   parentId Int?    @map(name: "parent_id")
-  ref         String? // this can be used to reference a thread to content
   ballot      Ballot?
   children    Thread[]     @relation("ThreadToThread")
   reactions   Reaction[]
   attachments Attachment[]
@@ -240,15 +249,16 @@
   @@map(name: "threads")
 }
 model Reaction {
-  id        Int      @default(autoincrement()) @id
-  emoij     String
-  user      User     @relation(fields: [userId], references: [id])
-  userId    Int      @map(name: "user_id")
-  thread    Thread?  @relation(fields: [threadId], references: [id])
-  threadId  Int?     @map(name: "thread_id")
+  id    Int    @default(autoincrement()) @id
+  emoij String
+
+  user     User    @relation(fields: [userId], references: [id])
+  userId   Int     @map(name: "user_id")
+  thread   Thread? @relation(fields: [threadId], references: [id])
+  threadId Int?    @map(name: "thread_id")
+
   createdAt DateTime @default(now()) @map(name: "created_at")
   updatedAt DateTime @default(now()) @map(name: "updated_at")
-
   @@map(name: "reactions")
 }
```


