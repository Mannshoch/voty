# Migration `20201108202746-changed-thread-model`

This migration has been generated by Stefan N at 11/8/2020, 9:27:47 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."ballots_thread_id_unique"

ALTER TABLE "public"."ballots" DROP CONSTRAINT "ballots_thread_id_fkey"

ALTER TABLE "public"."threads" DROP CONSTRAINT "threads_parent_id_fkey"

ALTER TABLE "public"."ballots" DROP COLUMN "thread_id"

ALTER TABLE "public"."threads" DROP COLUMN "parent_id",
ADD COLUMN "team_id" text   NOT NULL ,
ADD COLUMN "schoolId" text   ,
ALTER COLUMN "ref" SET NOT NULL

ALTER TABLE "public"."threads" ADD FOREIGN KEY ("team_id")REFERENCES "public"."teams"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."threads" ADD FOREIGN KEY ("schoolId")REFERENCES "public"."schools"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201019132116-re-initialization..20201108202746-changed-thread-model
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -85,8 +85,9 @@
   User       User[]
   BallotRuns BallotRun[]
   Vote       Vote[]
   Voted      Voted[]
+  Thread     Thread[]
   @@map(name: "teams")
 }
 model School {
@@ -103,10 +104,11 @@
   members  User[]
   teams    Team[]
   ballots  Ballot[]
-  Vote  Vote[]
-  Voted Voted[]
+  Vote   Vote[]
+  Voted  Voted[]
+  Thread Thread[]
   @@map(name: "schools")
 }
 model Domain {
@@ -151,10 +153,8 @@
   team      Team?   @relation(fields: [teamId], references: [id])
   teamId    String? @map(name: "team_id")
   creator   User?   @relation(fields: [creatorId], references: [id])
   creatorId String? @map(name: "creator_id")
-  thread    Thread? @relation(fields: [threadId], references: [id])
-  threadId  String? @map(name: "thread_id")
   options     Option[]
   voted       Voted[]      @relation("VotedBallot")
   votes       Vote[]
@@ -246,26 +246,26 @@
   @@map(name: "attachments")
 }
 model Thread {
-  id    String  @id @default(cuid())
-  title String  @default("")
-  text  String  @default("")
-  ref   String? // this can be used to reference a thread to content
+  id    String @id @default(cuid())
+  title String @default("")
+  text  String @default("")
+  ref   String // this can be used to reference a thread to content
-  user     User    @relation(fields: [userId], references: [id])
-  userId   String  @map(name: "user_id")
-  parent   Thread? @relation(fields: [parentId], references: [id])
-  parentId String? @map(name: "parent_id")
+  user   User   @relation(fields: [userId], references: [id])
+  userId String @map(name: "user_id")
+  team   Team   @relation(fields: [teamId], references: [id])
+  teamId String @map(name: "team_id")
-  ballot      Ballot?
-  children    Thread[]     @relation("ThreadToThread")
   reactions   Reaction[]
   attachments Attachment[]
   createdAt DateTime @default(now()) @map(name: "created_at")
   updatedAt DateTime @default(now()) @map(name: "updated_at")
   @@map(name: "threads")
+  School   School? @relation(fields: [schoolId], references: [id])
+  schoolId String?
 }
 model Reaction {
   id    String @id @default(cuid())
```


